<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Keystroke Recorder</title>
  <script type="module">
    // Import Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, collection, addDoc, query, where, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    // Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCzBntT2pTBhDwYxQJj2sVQG9VzvzdWV8c",
      authDomain: "shareable-2ec0f.firebaseapp.com",
      projectId: "shareable-2ec0f",
      storageBucket: "shareable-2ec0f.appspot.com",
      messagingSenderId: "965298003271",
      appId: "1:965298003271:web:7d46fd3ac9bbce285b4062"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Helper to get or create sessionId
    function getSessionId() {
      const urlParams = new URLSearchParams(window.location.search);
      let sessionId = urlParams.get('sessionId');
      if (!sessionId) {
        sessionId = Math.random().toString(36).substr(2, 9);
        window.location.search = `?sessionId=${sessionId}`;
      }
      return sessionId;
    }

    const sessionId = getSessionId();
    document.getElementById('session-link').value = window.location.href;

    // Record keystrokes
    document.addEventListener("keydown", async (event) => {
      await addDoc(collection(db, "keystrokes"), {
        key: event.key,
        sessionId,
        timestamp: Date.now()
      });
    });

    // Display keystrokes for this session
    const keystrokesList = document.getElementById('keystrokes');
    const q = query(collection(db, "keystrokes"), where("sessionId", "==", sessionId));
    onSnapshot(q, (querySnapshot) => {
      keystrokesList.innerHTML = "";
      const sorted = querySnapshot.docs
        .map(doc => doc.data())
        .sort((a, b) => a.timestamp - b.timestamp);
      for (const data of sorted) {
        const li = document.createElement('li');
        li.textContent = `${data.key} (${new Date(data.timestamp).toLocaleTimeString()})`;
        keystrokesList.appendChild(li);
      }
    });

    // Copy link button
    document.getElementById('copy-link').onclick = function() {
      const link = document.getElementById('session-link');
      link.select();
      document.execCommand('copy');
      alert('Link copied!');
    };
  </script>
</head>
<body>
  <h1>Keystroke Recorder</h1>
  <p>
    Share this link to record keystrokes for this session:<br>
    <input id="session-link" style="width:80%" readonly>
    <button id="copy-link">Copy Link</button>
  </p>
  <h2>Keystrokes for this session:</h2>
  <ul id="keystrokes"></ul>
  <p><em>Open this link on another device to record keystrokes from there as well.</em></p>
</body>
</html> 